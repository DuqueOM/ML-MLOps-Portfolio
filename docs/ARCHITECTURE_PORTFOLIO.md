# ðŸ— Global Portfolio Architecture

This document describes the high-level architecture of the `ML-MLOps-Portfolio`, which implements a **Microservices Architecture** pattern for Machine Learning systems. Each project acts as an independent service, sharing common infrastructure and MLOps practices.

## 1. System Overview

The portfolio consists of three primary ML microservices, each responsible for a specific business domain, orchestrating their own data pipelines, training jobs, and inference APIs.

```mermaid
graph TD
    subgraph "Client Layer"
        User[End User]
        ExtApp[External Application]
    end

    subgraph "Gateway / Ingress (Optional)"
        Nginx[Nginx / Ingress Controller]
    end

    subgraph "Service Layer (Microservices)"
        subgraph "BankChurn Predictor"
            BC_API[FastAPI Service]
            BC_Model[XGBoost Model]
        end
        
        subgraph "CarVision Intelligence"
            CV_Dash[Streamlit Dashboard]
            CV_API[FastAPI Service]
            CV_Model[RandomForest Model]
        end
        
        subgraph "TelecomAI Intelligence"
            TA_API[FastAPI Service]
            TA_Model[Voting Classifier]
        end
    end

    subgraph "MLOps Infrastructure"
        MLflow[MLflow Tracking Server]
        Reg[Docker Registry (GHCR)]
        S3[Artifact Store (Local/Cloud)]
    end

    User --> CV_Dash
    ExtApp --> BC_API
    ExtApp --> CV_API
    ExtApp --> TA_API
    
    BC_API --> BC_Model
    CV_API --> CV_Model
    TA_API --> TA_Model
    
    BC_API -.-> MLflow
    CV_API -.-> MLflow
    TA_API -.-> MLflow
```

## 2. Shared Infrastructure & Principles

All services adhere to the **12-Factor App** methodology and share the following architectural pillars:

### 2.1 Containerization
- **Base Image**: `python:3.11-slim` or `3.12-slim` for minimal footprint.
- **Multi-stage Builds**: Used to separate build dependencies from runtime artifacts, reducing image size by ~60%.
- **Non-root User**: Security best practice enforced in all Dockerfiles (`appuser`).

### 2.2 CI/CD Pipeline (`ci-mlops.yml`)
A unified GitHub Actions workflow orchestrates the lifecycle of all projects:
1. **Validation**: Data quality checks and linting (flake8, black, mypy).
2. **Testing**: Unit and integration tests with pytest.
3. **Security**: Vulnerability scanning (Trivy, Bandit).
4. **Delivery**: Automated Docker builds and pushes to GitHub Container Registry.

### 2.3 Experiment Tracking
- **MLflow** is used centrally to track experiments, parameters, and metrics.
- Models are registered with versioning to ensure traceability.
- During local development, MLflow runs with a local SQLite backend.

## 3. Project Specifics

### ðŸ¦ BankChurn Predictor
- **Type**: Classification Service.
- **Key Components**:
  - `ChurnTrainer`: Encapsulates training logic.
  - `ChurnPredictor`: Handles inference with unified pipeline artifacts.
- **Latency**: Optimized for sub-100ms response time.

### ðŸš— CarVision Market Intelligence
- **Type**: Hybrid (Dashboard + API).
- **Key Components**:
  - `Streamlit`: Provides interactive data visualization.
  - `FastAPI`: Serves price predictions via REST.
- **Data Flow**:
  - Raw Data -> Cleaning -> Feature Eng -> Training -> Visualization.

### ðŸ“± TelecomAI Customer Intelligence
- **Type**: Advanced Analytics Service.
- **Key Components**:
  - `VotingClassifier`: Ensemble method for robust predictions.
  - `ResampleClassifier`: Handles class imbalance inside the pipeline.
- **Focus**: High recall for identifying at-risk customers.

## 4. Data Architecture

We use **DVC (Data Version Control)** (conceptual) to manage large datasets and pipeline stages.

- **Raw Data**: Immutable, stored in `data/raw`.
- **Processed Data**: Generated by preprocessing scripts, not versioned in git.
- **Artifacts**: Trained models (`.joblib`, `.pkl`) are treated as build artifacts.

## 5. Future Scalability (Kubernetes)

The architecture is designed to be "Kubernetes-Ready":
- **Stateless**: Services store no session state.
- **Configurable**: All configuration via Environment Variables.
- **Health Checks**: Implemented `/health` endpoints for liveness/readiness probes.
- **Resiliency**: Retry logic in clients and database connections.

```yaml
# Conceptual K8s Deployment
apiVersion: apps/v1
kind: Deployment
metadata:
  name: bankchurn-api
spec:
  replicas: 3
  selector:
    matchLabels:
      app: bankchurn
  template:
    metadata:
      labels:
        app: bankchurn
    spec:
      containers:
      - name: api
        image: ghcr.io/duqueom/bankchurn:latest
        env:
        - name: MLFLOW_URI
          value: "http://mlflow-service:5000"
```
